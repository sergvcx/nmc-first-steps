BOARD=@BOARD@
#BOARD SUPPORT PACKAGE
CORE=@CORE@

BSP_DIR=@BSP_DIR@


@SHELL@
@INCLUDE_MK@
.SUFFIXES:


TARGET    = @TARGET@.abs
TARGETD   = @TARGET@d.abs
OS_RM     = @OS_RM@ 

CC       = nmc-g++
AS       = nmc-gcc
CXXFLAGS = -std=c++11 -O2 -Wall -mnmc4 -g
LIBS     = -Wl,--whole-archive @LIBS@  -Wl,--no-whole-archive  
LIBSD    = -Wl,--whole-archive @LIBSD@ -Wl,--no-whole-archive  
CFG      = @CFG@
MAP      = $(TARGET).map
LDFLAGS  = -Wl,-Map=$(MAP) -Wl,-T$(CFG) 
INC_DIRS = -I"$(BSP_DIR)/include" 
LIB_DIRS = -L"$(BSP_DIR)/lib" -L"$(NMCGCC)/lib" -L.


SRC_ALL   = @SRC_FILES@

.DEFAULT_GOAL := all

all: $(TARGET) $(TARGET_GDB)

$(TARGET): $(SRC_ALL) Makefile 
	$(CC)  -o$(TARGET) $(CXXFLAGS) $(LDFLAGS) $(SRC_ALL) $(INC_DIRS) $(LIB_DIRS) $(LIBS)
	
$(TARGETD): $(SRC_ALL) Makefile 
	$(CC)  -o$(TARGET) $(CXXFLAGS) $(LDFLAGS) $(SRC_ALL) $(INC_DIRS) $(LIB_DIRS) 

run: 
	@RUN@

qemu:	
	nmc-qemu -g 5555 $(TARGET)


# set path to MinGW/bin    For example:  SET PATH=%PATH%;d:\SDK\msys64\mingw64\bin\
monitor:
	nm_gdb_monitor.exe
	
gdb :	
	nmc-gdb  $(TARGET)


clean: 
	-$(OS_RM) *.abs *.elf *.map 
	

